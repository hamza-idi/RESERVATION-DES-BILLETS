<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vente de Billets — Réservation</title>
<style>
    :root{
        --bg:#f4f6f8;
        --card:#ffffff;
        --primary:#0b63ff;
        --muted:#6b7280;
        --success:#10b981;
        --danger:#ef4444;
        --glass: rgba(255,255,255,0.7);
        font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        background: linear-gradient(180deg,#eef2ff 0%,var(--bg) 100%);
        color:#111827;
        min-height:100vh;
        display:flex;
        align-items:flex-start;
        justify-content:center;
        padding:32px 16px;
    }

    .container{
        width:100%;
        max-width:1100px;
        display:grid;
        grid-template-columns: 1fr 420px;
        gap:28px;
        align-items:start;
    }

    header{
        grid-column:1 / -1;
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:16px;
        margin-bottom:6px;
    }
    .brand{
        display:flex;
        gap:12px;
        align-items:center;
    }
    .logo{
        width:52px;
        height:52px;
        border-radius:10px;
        background:linear-gradient(135deg,var(--primary),#7c3aed);
        display:flex;
        align-items:center;
        justify-content:center;
        color:white;
        font-weight:700;
        font-size:20px;
        box-shadow:0 6px 18px rgba(11,99,255,0.15);
    }
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:14px}

    /* Event list */
    .events{
        display:grid;
        gap:14px;
    }
    .card{
        background:var(--card);
        border-radius:12px;
        padding:14px;
        box-shadow:0 6px 20px rgba(16,24,40,0.06);
        display:flex;
        gap:12px;
        align-items:center;
    }
    .thumb{
        width:90px;
        height:64px;
        border-radius:8px;
        flex-shrink:0;
        background-size:cover;
        background-position:center;
        box-shadow:inset 0 -8px 18px rgba(0,0,0,0.06);
    }
    .event-meta{flex:1}
    .event-meta h3{margin:0;font-size:16px}
    .meta-small{color:var(--muted);font-size:13px;margin-top:6px}
    .price-badge{
        font-weight:700;
        color:var(--primary);
        font-size:15px;
    }
    .select-btn{
        background:transparent;
        border:1px solid rgba(11,99,255,0.12);
        color:var(--primary);
        padding:8px 12px;
        border-radius:8px;
        cursor:pointer;
    }

    /* Reservation panel */
    .panel{
        background:linear-gradient(180deg,var(--glass),#fff);
        padding:18px;
        border-radius:12px;
        box-shadow:0 10px 30px rgba(2,6,23,0.06);
        position:sticky;
        top:32px;
    }
    .panel h2{margin:0 0 10px 0;font-size:16px}
    label{display:block;font-size:13px;margin:8px 0 6px;color:#374151}
    select,input[type="number"],input[type="text"],input[type="email"]{
        width:100%;
        padding:10px 12px;
        border-radius:8px;
        border:1px solid #e6edf3;
        outline:none;
        font-size:14px;
    }
    .row{display:flex;gap:10px}
    .row .col{flex:1}
    .summary{
        margin-top:14px;
        padding:12px;
        border-radius:8px;
        background:linear-gradient(180deg,#fbfdff,#ffffff);
        border:1px solid #eef2ff;
    }
    .summary .line{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:14px}
    .total{font-weight:700;font-size:18px;color:#0b63ff}
    .actions{display:flex;gap:10px;margin-top:12px}
    .primary{
        background:var(--primary);
        color:white;
        border:0;
        padding:10px 12px;
        border-radius:10px;
        cursor:pointer;
        flex:1;
    }
    .secondary{
        background:transparent;
        border:1px solid #e6edf3;
        padding:10px 12px;
        border-radius:10px;
        cursor:pointer;
        color:#374151;
        flex:1;
    }

    /* Confirmation modal (simple) */
    .modal-backdrop{
        position:fixed;
        inset:0;
        background:rgba(2,6,23,0.45);
        display:none;
        align-items:center;
        justify-content:center;
        z-index:60;
    }
    .modal{
        background:white;
        padding:20px;
        border-radius:12px;
        width:100%;
        max-width:480px;
        box-shadow:0 12px 32px rgba(2,6,23,0.25);
    }
    .modal h3{margin:0 0 10px 0}
    .close{
        background:#f3f4f6;
        border:0;
        padding:6px 8px;
        border-radius:8px;
        cursor:pointer;
    }
    .success-tag{
        display:inline-block;
        background:linear-gradient(90deg,#ecfdf5,#d1fae5);
        color:var(--success);
        padding:6px 8px;
        border-radius:8px;
        font-weight:600;
    }

    /* empty state */
    .empty{
        text-align:center;
        padding:40px;
        color:var(--muted);
    }

    /* responsive */
    @media (max-width:980px){
        .container{grid-template-columns:1fr; padding-bottom:80px}
        .panel{position:static}
    }
</style>
</head>
<body>
<div class="container" role="main">
    <header>
        <div class="brand" aria-hidden="false">
            <div class="logo">RB</div>
            <div>
                <h1>Réservation Billets</h1>
                <p class="lead">Choisissez un événement et réservez vos places en quelques clics.</p>
            </div>
        </div>
        <div aria-hidden="true" style="text-align:right">
            <div style="font-weight:700;color:#111827">Compte démo</div>
            <div style="color:var(--muted);font-size:13px">test@exemple.com</div>
        </div>
    </header>

    <section class="events" aria-label="Liste des événements">
        <!-- Events will be injected by JS -->
        <div class="empty" id="events-empty" style="display:none">
            <p>Aucun événement disponible pour l'instant.</p>
        </div>
    </section>

    <aside class="panel" aria-label="Panneau de réservation">
        <h2>Votre réservation</h2>

        <label for="event-select">Événement</label>
        <select id="event-select" aria-label="Sélection de l'événement">
            <option value="">— Choisir un événement —</option>
        </select>

        <div class="row" style="margin-top:6px">
            <div class="col">
                <label for="qty">Nombre de billets</label>
                <input id="qty" type="number" min="1" value="1" />
            </div>
            <div class="col">
                <label for="tarif">Tarif</label>
                <select id="tarif" aria-label="Sélection du tarif">
                    <option value="standard" data-mult="1">Standard</option>
                    <option value="reduit" data-mult="0.75">Réduit (étudiant/sénior)</option>
                    <option value="vip" data-mult="1.5">VIP</option>
                </select>
            </div>
        </div>

        <label for="name">Nom complet</label>
        <input id="name" type="text" placeholder="Jean Dupont" />

        <label for="email">Email</label>
        <input id="email" type="email" placeholder="jean@exemple.com" />

        <div class="summary" aria-live="polite">
            <div class="line"><span>Sous-total</span><span id="subtotal">0 €</span></div>
            <div class="line"><span>Frais de service</span><span id="fees">0 €</span></div>
            <div class="line total"><span>Total</span><span id="total">0 €</span></div>
        </div>

        <div class="actions">
            <button class="primary" id="reserve-btn">Réserver</button>
            <button class="secondary" id="reset-btn" type="button">Remise à zéro</button>
        </div>

        <p style="margin-top:10px;color:var(--muted);font-size:13px">
            Les prix affichés sont en euros. Paiement simulé (aucune transaction réelle).
        </p>
    </aside>
</div>

<!-- Modal confirmation -->
<div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <h3 id="modal-title">Réservation confirmée</h3>
            <button class="close" id="close-modal" aria-label="Fermer">✕</button>
        </div>
        <p id="modal-body" style="color:#374151;margin-bottom:12px"></p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
            <button class="secondary" id="download-btn">Télécharger reçu (PDF)</button>
            <button class="primary" id="done-btn">Terminé</button>
        </div>
    </div>
</div>

<script>
/*
  Exemple de site de réservation côté client.
  - Données d'événements simulées en JS.
  - Calcul du total : prix * qty * tarif + frais (fixe + %).
  - Validation simple du formulaire.
  - Pas de back-end ni paiement réel.
*/

const eventsData = [
    {
        id: 'evt1',
        title: 'Concert — Les Ondes Libres',
        date: '2026-05-12 20:00',
        location: 'Théâtre Municipal',
        price: 35.00,
        img: 'https://images.unsplash.com/photo-1485579149621-3123dd979885?auto=format&fit=crop&w=800&q=60'
    },
    {
        id: 'evt2',
        title: 'Match — FC Ville vs Mont-Roche',
        date: '2026-06-01 18:30',
        location: 'Stade Central',
        price: 22.50,
        img: 'https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=800&q=60'
    },
    {
        id: 'evt3',
        title: 'Théâtre — La Nuit d\'Avril',
        date: '2026-07-09 19:30',
        location: 'Salle des Fêtes',
        price: 18.00,
        img: 'https://images.unsplash.com/photo-1508057198894-247b23fe5ade?auto=format&fit=crop&w=800&q=60'
    }
];

const eventsEl = document.querySelector('.events');
const eventSelect = document.getElementById('event-select');
const qtyInput = document.getElementById('qty');
const tarifSelect = document.getElementById('tarif');
const nameInput = document.getElementById('name');
const emailInput = document.getElementById('email');

const subtotalEl = document.getElementById('subtotal');
const feesEl = document.getElementById('fees');
const totalEl = document.getElementById('total');

const reserveBtn = document.getElementById('reserve-btn');
const resetBtn = document.getElementById('reset-btn');

const modal = document.getElementById('modal');
const modalBody = document.getElementById('modal-body');
const closeModal = document.getElementById('close-modal');
const downloadBtn = document.getElementById('download-btn');
const doneBtn = document.getElementById('done-btn');

function formatPrice(v){
    return v.toLocaleString('fr-FR', { style:'currency', currency:'EUR', maximumFractionDigits:2 });
}

function renderEvents(){
    if(!eventsData.length){
        document.getElementById('events-empty').style.display='block';
        return;
    }
    eventsData.forEach(ev=>{
        // populate select
        const opt = document.createElement('option');
        opt.value = ev.id;
        opt.textContent = `${ev.title} — ${formatPrice(ev.price)}`;
        opt.dataset.price = ev.price;
        eventSelect.appendChild(opt);

        // card
        const card = document.createElement('div');
        card.className='card';
        const thumb = document.createElement('div');
        thumb.className='thumb';
        thumb.style.backgroundImage = `url(${ev.img})`;

        const meta = document.createElement('div');
        meta.className='event-meta';
        const h3 = document.createElement('h3');
        h3.textContent = ev.title;
        const small = document.createElement('div');
        small.className='meta-small';
        small.textContent = `${ev.date} • ${ev.location}`;

        const right = document.createElement('div');
        right.style.textAlign='right';
        const price = document.createElement('div');
        price.className='price-badge';
        price.textContent = formatPrice(ev.price);
        const btn = document.createElement('button');
        btn.className='select-btn';
        btn.textContent='Sélectionner';
        btn.addEventListener('click', ()=> {
            eventSelect.value = ev.id;
            updateTotals();
            // scroll to panel (mobile)
            window.scrollTo({ top: document.querySelector('.panel').offsetTop - 20, behavior:'smooth' });
        });

        meta.appendChild(h3);
        meta.appendChild(small);
        right.appendChild(price);
        right.appendChild(btn);

        card.appendChild(thumb);
        card.appendChild(meta);
        card.appendChild(right);

        eventsEl.appendChild(card);
    });
}

function getSelectedEvent(){
    const id = eventSelect.value;
    return eventsData.find(e=>e.id===id) || null;
}

function computeFees(subtotal){
    // frais fixes + pourcentage
    const fixed = 1.5; // frais de service fixe
    const percent = 0.05; // 5%
    return +(fixed + subtotal * percent);
}

function updateTotals(){
    const ev = getSelectedEvent();
    const qty = Math.max(1, parseInt(qtyInput.value) || 1);
    const tarifMult = parseFloat(tarifSelect.options[tarifSelect.selectedIndex].dataset.mult) || 1;
    if(!ev){
        subtotalEl.textContent = '0 €';
        feesEl.textContent = '0 €';
        totalEl.textContent = '0 €';
        return;
    }
    const base = ev.price * qty * tarifMult;
    const fees = computeFees(base);
    const total = +(base + fees);

    subtotalEl.textContent = formatPrice(base);
    feesEl.textContent = formatPrice(fees);
    totalEl.textContent = formatPrice(total);
}

function validateForm(){
    const ev = getSelectedEvent();
    if(!ev){
        alert('Veuillez sélectionner un événement.');
        return false;
    }
    const qty = Math.max(1, parseInt(qtyInput.value) || 0);
    if(qty < 1){
        alert('Le nombre de billets doit être au moins 1.');
        return false;
    }
    const name = nameInput.value.trim();
    if(name.length < 2){
        alert('Veuillez entrer votre nom complet.');
        return false;
    }
    const email = emailInput.value.trim();
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailPattern.test(email)){
        alert('Veuillez entrer une adresse e-mail valide.');
        return false;
    }
    return true;
}

reserveBtn.addEventListener('click', (e)=> {
    if(!validateForm()) return;
    // build summary
    const ev = getSelectedEvent();
    const qty = Math.max(1, parseInt(qtyInput.value) || 1);
    const tarifText = tarifSelect.options[tarifSelect.selectedIndex].textContent;
    const subtotal = parseCurrency(subtotalEl.textContent);
    const fees = parseCurrency(feesEl.textContent);
    const total = parseCurrency(totalEl.textContent);

    const reservation = {
        id: 'R-' + Math.random().toString(36).slice(2,10).toUpperCase(),
        event: ev.title,
        date: ev.date,
        location: ev.location,
        qty,
        tarif: tarifText,
        name: nameInput.value.trim(),
        email: emailInput.value.trim(),
        subtotal, fees, total
    };

    // Show modal with summary
    modalBody.innerHTML = `
        <div style="margin-bottom:8px">
            <span class="success-tag">Réussite</span>
        </div>
        <div style="font-weight:700;margin-bottom:6px">Réservation ${reservation.id}</div>
        <div style="color:var(--muted);font-size:14px">
            ${reservation.event} — ${reservation.date} • ${reservation.location}
        </div>
        <div style="margin-top:8px">
            ${reservation.qty} × ${reservation.tarif} — <strong>${formatPrice(reservation.total)}</strong>
        </div>
        <div style="margin-top:10px;color:#374151;font-size:13px">
            Un email de confirmation a été envoyé à <strong>${escapeHtml(reservation.email)}</strong> (simulation).
        </div>
    `;
    modal.style.display='flex';

    // simulate saving / emailing
    console.log('Réservation (simulée) :', reservation);
});

closeModal.addEventListener('click', ()=> modal.style.display='none');
doneBtn.addEventListener('click', ()=> modal.style.display='none');

resetBtn.addEventListener('click', ()=>{
    eventSelect.value='';
    qtyInput.value='1';
    tarifSelect.value='standard';
    nameInput.value='';
    emailInput.value='';
    updateTotals();
});

// helper: parse "12,34 €" or "€12.34" style back to number
function parseCurrency(str){
    if(!str) return 0;
    // remove non digits, replace comma by dot
    const cleaned = str.replace(/[^\d,.-]/g,'').replace(',', '.');
    return parseFloat(cleaned) || 0;
}

function escapeHtml(s){
    return s.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
}

// update totals whenever inputs change
[eventSelect, qtyInput, tarifSelect].forEach(el=>{
    el.addEventListener('change', updateTotals);
    el.addEventListener('input', updateTotals);
});
nameInput.addEventListener('input', ()=>{}); // placeholder for future validation
emailInput.addEventListener('input', ()=>{});

// download receipt (very simple text saved as .txt to simulate PDF)
downloadBtn.addEventListener('click', ()=>{
    const bodyText = modalBody.textContent || 'Reçu de réservation';
    const blob = new Blob([bodyText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'reservation-recu.txt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
});

// initial render
renderEvents();
updateTotals();

</script>
</body>
</html>